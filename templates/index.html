<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin AI Trading Bot Dashboard</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(0,0,0,0.2);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .status {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .status-item {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .status-online {
            background: linear-gradient(45deg, #4CAF50, #45a049);
        }
        
        .status-offline {
            background: linear-gradient(45deg, #f44336, #da190b);
        }
        
        .status-demo {
            background: linear-gradient(45deg, #ff9800, #f57c00);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-gap: 2rem;
        }
        
        .card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .card h3 {
            margin-bottom: 1rem;
            color: #ffd700;
            font-size: 1.2rem;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 0.5rem;
        }
        
        .price-display {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 1rem 0;
            color: #00ff88;
        }
        
        .signal-card {
            text-align: center;
        }
        
        .signal-action {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 10px;
        }
        
        .signal-buy {
            color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }
        
        .signal-sell {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }
        
        .signal-hold {
            color: #ffaa00;
            background: rgba(255, 170, 0, 0.1);
        }
        
        .confidence-bar {
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ffaa00, #00ff88);
            transition: width 0.5s ease;
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .btn {
            flex: 1;
            padding: 0.8rem;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }
        
        .btn-start {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }
        
        .btn-stop {
            background: linear-gradient(45deg, #f44336, #da190b);
            color: white;
        }
        
        .btn-test {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .metric {
            text-align: center;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.5rem;
        }
        
        .chart-container {
            grid-column: 1 / -1;
            height: 400px;
            margin-top: 2rem;
        }
        
        .log-container {
            grid-column: 1 / -1;
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0,0,0,0.3);
            padding: 1rem;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.3rem;
            border-left: 3px solid #ffd700;
            padding-left: 0.8rem;
        }
        
        .ai-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .ai-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4444;
            animation: pulse 2s infinite;
        }
        
        .ai-connected {
            background: #00ff88;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .responsive {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">ü§ñ Bitcoin AI Trading Bot</div>
        <div class="status">
            <div class="status-item {{ 'status-online' if bot_state.get('running') else 'status-offline' }}">
                {{ 'ƒêANG HO·∫†T ƒê·ªòNG' if bot_state.get('running') else 'T·∫†M D·ª™NG' }}
            </div>
            <div class="status-item status-demo">
                {{ 'DEMO MODE' if bot_state.get('demo_mode') else 'LIVE MODE' }}
            </div>
        </div>
    </div>

    <div class="container">
        <!-- AI Status Card -->
        <div class="card">
            <h3>üß† Tr·∫°ng Th√°i AI</h3>
            <div class="ai-status">
                <div class="ai-indicator" id="ai-indicator"></div>
                <span id="ai-status-text">ƒêang ki·ªÉm tra...</span>
            </div>
            <div class="controls">
                <button class="btn btn-test" onclick="testAI()">Test AI</button>
            </div>
        </div>

        <!-- Price Card -->
        <div class="card">
            <h3>üí∞ Gi√° Bitcoin</h3>
            <div class="price-display" id="current-price">$0</div>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value" id="price-change">0%</div>
                    <div class="metric-label">Thay ƒë·ªïi 24h</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="volume">0</div>
                    <div class="metric-label">Volume</div>
                </div>
            </div>
        </div>

        <!-- Signal Card -->
        <div class="card signal-card">
            <h3>üìä T√≠n Hi·ªáu Trading</h3>
            <div class="signal-action signal-hold" id="signal-action">HOLD</div>
            <div>ƒê·ªô tin c·∫≠y: <span id="confidence-percent">50%</span></div>
            <div class="confidence-bar">
                <div class="confidence-fill" id="confidence-fill" style="width: 50%"></div>
            </div>
            <div id="signal-reasoning">Ch·ªù t√≠n hi·ªáu AI...</div>
        </div>

        <!-- Control Card -->
        <div class="card">
            <h3>‚öôÔ∏è ƒêi·ªÅu Khi·ªÉn Bot</h3>
            <div class="controls">
                <button class="btn btn-start" onclick="startBot()" id="start-btn">
                    {{ 'D·ª™NG BOT' if bot_state.get('running') else 'KH·ªûI ƒê·ªòNG' }}
                </button>
            </div>
            <div class="controls">
                <button class="btn btn-test" onclick="toggleMode()">
                    {{ 'Chuy·ªÉn LIVE' if bot_state.get('demo_mode') else 'Chuy·ªÉn DEMO' }}
                </button>
            </div>
        </div>

        <!-- Performance Card -->
        <div class="card">
            <h3>üìà Hi·ªáu Su·∫•t</h3>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value" id="total-trades">0</div>
                    <div class="metric-label">T·ªïng Giao D·ªãch</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="win-rate">0%</div>
                    <div class="metric-label">T·ªâ L·ªá Th·∫Øng</div>
                </div>
            </div>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value" id="profit-loss">$0</div>
                    <div class="metric-label">L√£i/L·ªó</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="balance">$10,000</div>
                    <div class="metric-label">S·ªë D∆∞</div>
                </div>
            </div>
        </div>

        <!-- Technical Indicators Card -->
        <div class="card">
            <h3>üìä Ch·ªâ B√°o K·ªπ Thu·∫≠t</h3>
            <div class="metrics">
                <div class="metric">
                    <div class="metric-value" id="rsi">50</div>
                    <div class="metric-label">RSI</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="macd">0</div>
                    <div class="metric-label">MACD</div>
                </div>
            </div>
        </div>

        <!-- Price Chart -->
        <div class="card chart-container">
            <h3>üìà Bi·ªÉu ƒê·ªì Gi√°</h3>
            <div id="price-chart" class="responsive"></div>
        </div>

        <!-- Activity Log -->
        <div class="card log-container">
            <h3>üìù Nh·∫≠t K√Ω Ho·∫°t ƒê·ªông</h3>
            <div id="activity-log">
                <div class="log-entry">[18:27:00] Dashboard kh·ªüi ƒë·ªông th√†nh c√¥ng</div>
            </div>
        </div>
    </div>

    <script>
        // Socket.IO connection
        const socket = io();
        
        // Initialize chart
        let priceChart = {
            x: [],
            y: [],
            type: 'scatter',
            mode: 'lines',
            name: 'BTC Price',
            line: { color: '#ffd700', width: 2 }
        };
        
        Plotly.newPlot('price-chart', [priceChart], {
            title: 'Bitcoin Price (USD)',
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: 'white' },
            xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
            yaxis: { gridcolor: 'rgba(255,255,255,0.1)' }
        });

        // Socket event handlers
        socket.on('connect', function() {
            addLog('K·∫øt n·ªëi WebSocket th√†nh c√¥ng');
        });

        socket.on('price_update', function(data) {
            updatePrice(data);
        });

        socket.on('signal_update', function(data) {
            updateSignal(data);
        });

        socket.on('ai_status', function(data) {
            updateAIStatus(data.connected);
        });

        socket.on('bot_status', function(data) {
            updateBotStatus(data);
        });

        // Functions
        function updatePrice(data) {
            document.getElementById('current-price').textContent = `$${data.price.toLocaleString()}`;
            document.getElementById('price-change').textContent = `${data.change >= 0 ? '+' : ''}${data.change.toFixed(2)}%`;
            document.getElementById('volume').textContent = `${(data.volume / 1000000).toFixed(1)}M`;
            
            // Update chart
            priceChart.x.push(new Date());
            priceChart.y.push(data.price);
            
            if (priceChart.x.length > 100) {
                priceChart.x.shift();
                priceChart.y.shift();
            }
            
            Plotly.redraw('price-chart');
        }

        function updateSignal(data) {
            const actionElement = document.getElementById('signal-action');
            const confidenceElement = document.getElementById('confidence-fill');
            const percentElement = document.getElementById('confidence-percent');
            const reasoningElement = document.getElementById('signal-reasoning');
            
            actionElement.textContent = data.action;
            actionElement.className = `signal-action signal-${data.action.toLowerCase()}`;
            
            const confidence = Math.round(data.confidence * 100);
            confidenceElement.style.width = `${confidence}%`;
            percentElement.textContent = `${confidence}%`;
            reasoningElement.textContent = data.reasoning || 'Kh√¥ng c√≥ l√Ω do c·ª• th·ªÉ';
            
            addLog(`T√≠n hi·ªáu m·ªõi: ${data.action} (${confidence}% confidence)`);
        }

        function updateAIStatus(connected) {
            const indicator = document.getElementById('ai-indicator');
            const statusText = document.getElementById('ai-status-text');
            
            if (connected) {
                indicator.classList.add('ai-connected');
                statusText.textContent = 'DeepSeek AI ƒê√£ K·∫øt N·ªëi';
            } else {
                indicator.classList.remove('ai-connected');
                statusText.textContent = 'AI Ng·∫Øt K·∫øt N·ªëi';
            }
        }

        function updateBotStatus(data) {
            // Update various status indicators
            document.getElementById('total-trades').textContent = data.total_trades || 0;
            document.getElementById('win-rate').textContent = `${data.win_rate || 0}%`;
            document.getElementById('profit-loss').textContent = `$${data.profit_loss || 0}`;
            document.getElementById('balance').textContent = `$${data.balance || 10000}`;
            document.getElementById('rsi').textContent = data.rsi || 50;
            document.getElementById('macd').textContent = data.macd || 0;
        }

        function addLog(message) {
            const logContainer = document.getElementById('activity-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logContainer.insertBefore(logEntry, logContainer.firstChild);
            
            // Keep only last 50 entries
            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        // Control functions
        function startBot() {
            socket.emit('start_bot');
            addLog('G·ª≠i l·ªánh kh·ªüi ƒë·ªông bot...');
        }

        function toggleMode() {
            socket.emit('toggle_mode');
            addLog('Chuy·ªÉn ƒë·ªïi ch·∫ø ƒë·ªô trading...');
        }

        function testAI() {
            socket.emit('test_ai');
            addLog('ƒêang test k·∫øt n·ªëi AI...');
        }

        // Initialize
        window.onload = function() {
            addLog('Dashboard initialized');
            // Test AI connection on load
            testAI();
        };
    </script>
</body>
</html>
